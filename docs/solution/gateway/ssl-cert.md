# 认证证书

认证证书（Digital Certificate）是一种电子文档，用于证明实体（如服务器、个人或组织）的身份，由权威机构（CA，即证书颁发机构）签发。认证证书广泛应用于 HTTPS、邮件加密、代码签名等场景，确保通信的安全性和身份的可信性。其中，用于 HTTPS 的证书被称为 SSL/TLS 证书。

## 公开认证证书

从某种程度来说，认证证书就是做担保的中间人，由颁发证书的机构来确保网站可信。因此，在公网上发布的证书必须是由权威机构进行签发。

各大云厂商都提供了证书的申请业务。证书的申请有免费与付费两种模式。

| 比较项   | 免费证书                           | 付费证书                               |
| -------- | ---------------------------------- | -------------------------------------- |
| 安全性   | 基础加密，适合简单 HTTPS 使用。    | 提供基础加密和企业验证，增强用户信任。 |
| 续期     | 有效期通常为 90 天，需要频繁续期。 | 有效期为 1-2 年，可选择自动续期服务。  |
| 身份验证 | 仅验证域名所有权。                 | 可验证企业或组织身份（OV/EV）。        |
| 兼容性   | 兼容性稍弱，部分旧设备可能不支持。 | 更全面的兼容性。                       |
| 技术支持 | 无技术支持，需自行解决问题。       | 提供专业支持和服务保障。               |

> [!NOTE]
> 一般来说，免费证书就能满足基本的 HTTPS 的使用场景。有效期较短的问题，也可以通过一些自动化工具（Let’s Encrypt 的 [Cerbot](https://certbot.eff.org/)）实现自动续期。

## 自认证证书

在内网环境下，通过网络进行认证的公开认证可能会有影响，因此，您可以考虑使用自认证的方式，自行签发证书，从而实现内网环境下的 HTTPS 请求。

> [!IMPORTANT]
> 确保已在服务器上安装 Nginx 服务。

### OpenSSL

自签名证书需要依赖服务 `OpenSSL`，您可以通过包管理器直接进行安装。

### 生成自签名证书与私钥

1. 生成私钥文件：

```bash
openssl genrsa -out private.key 2048
```

2. 生成证书签名请求（CSR）:

```bash
openssl req -new -key private.key -out cert.csr -subj "/C=CN/ST=Beijing/L=Beijing/O=Company/OU=IT/CN=domain.com"
```

其中：

-   `private.key`是第一步生成的私钥。
-   `-subj` 提供了证书的详细信息，避免交互式填写。当然，您也可以取消这个参数，通过交互的方式填写相关信息。
    -   `/C=CN`：国家代码，例如中国为 CN，美国为 US。
    -   `/ST=State`：州或省的名称，例如 Beijing。
    -   `/L=City`：城市的名称，例如 Beijing。
    -   `/O=Organization`：组织名称，例如 YourCompany。
    -   `/OU=Unit`：组织部门，例如 IT Department。
    -   `/CN=yourdomain.com`：通用名称，通常填写域名或 IP。 对于内网，可以直接写内网域名或 IP 地址。

3. 生成自签名证书：

```bash
openssl x509 -req -days 365 -in cert.csr -signkey private.key -out cert.crt

```

其中：

-   `-x509`：指定生成的是一个自签名证书。
-   `-nodes`：表示生成的私钥不需要加密。
-   `-days`：指定证书的有效期（单位为 `天` )，此处设置为一年，可自行调整。
-   此命令需要指定私钥与签名请求，也就是前两步生成的结果。

至此，我们已经获得了 Nginx 配置 HTTPS 所需要的 crt 与 key 文件。

4. 如果您需要为活字格应用直接配置证书，需要将证书和私钥合并生成 PFX 文件：

```bash
openssl pkcs12 -export -out certificate.pfx -inkey private.key -in cert.crt
```

这一步会提示你输入导出密码，请记住这个密码。如果您不希望设置密码，也可以直接回车即可。

> [!NOTE]
> 自认证的证书是不会被浏览器信任的。因此客户端尽管可以正常访问绑定了自认证证书的 HTTPS 网站，但是会向客户提示证书不可信的警告。这是正常现象。客户端可以选择自行配置浏览器进行证书信任，从而规避该警告。
>
> 除非特别情况，生产环境下均建议使用受信任的 CA 机构颁发的证书。
